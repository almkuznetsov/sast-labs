## Часть 1. Cppcheck и CVE-2013-6462
[Cppcheck](https://cppcheck.sourceforge.io/) - статический анализатор с открытым исходным кодом.
Уязвимость CVE-2013-6462 была обнаружена с помощью cppcheck в проекте [libXfont](https://gitlab.freedesktop.org/xorg/lib/libxfont). LibXfont предоставляет ядро legacy системы шрифтов для оконной системы X11.
Давайте воспроизведем процесс обнаружения и исправления описанной уязвимости.

В ходе выполнения заданий 1 части у нас должны получиться следующие артефакты работы, прикрепленные к пулл реквесту:
- файл cppcheck.out с результатами первичного статического анализа
- файл cppcheck2.out с результатами статического анализа после исправления уязвимости
- файл, содержащий подготовленный с помощью `git format-patch` патч, испраляющий уязвимость

### Настройка окружения
Поскольку cppcheck работает с текстами программ, а не собирает их, нам потребуются только сам cppcheck и git
```shell
apt-get update
apt-get install git cppcheck
```
Склонируем себе репозиторий с проектом libXfont и перейдем в его директорию
```shell
git clone (your assignment repo link)
cd (your assignemnt repo)
```

### Статический анализ
В новой версии libxfont рассматриваемая нами уязвимость исправлена. Чтобы проанализировать код, где она еще не была исправлена, откатимся к версии 1.4.6
```shell
git checkout libXfont-1.4.6-branch
```
Запустим статический анализ со следующими опциями:
```shell
-j4 - запуск анализа в 4 потока для ускорения анализа
--enable=all - по умолчанию cppcheck использует небольшое количество проверок, которые с большой вероятностью не дадут ложных срабатываний, но мы включим все имеющиеся проверки
```
Также после команды анализа добавим `2> cppcheck.out`, чтобы перенаправить вывод информации об обнаруженных ошибках в файл `cppcheck.out`
В результате получится следующая команда для запуска анализа (не забываем о символе точки `.` - он указывает, где находятся файлы, которые мы анализируем):
```shell
cppcheck -j4 --enable=all . 2> cppcheck.out
```

### Разбор срабатываний
Откроем удобным текстовым редактором файл cppcheck.out. Как видим, в нем содержится большое количество сработок. Сегодня нас будет интересовать конкретная сработка - найдем ее по ключевому слову "sscanf" и строке `src/bitmap/bdfread.c:341`:
```
src/bitmap/bdfread.c:341:6: warning: sscanf() without field width limits can crash with huge input data. [invalidscanf]
```
Разберемся в проблеме, вызвавшей сработку - если не ограничивать количество символов, которые можно прочитать с помощью функции sscanf(), то атакующий может подать большой объем данных, который приведет к "падению" библиотеки, или даже запуску произвольного кода.

### Исправление ошибки
Для исправления данной проблемы необходимо ограничить максимальное количество символов, которые можно прочитать. Для этого можно, например заменить `"STARTCHAR %s` в указанной строке на `"STARTCHAR %80s`, ограничив ввод 80 символами.

Самостоятельно проведите указанное или подобное ему исправление, внесите его в систему контроля версий с помощью команд `git add` и `git commit` (если мы внутри контейнера, для этого может потребоваться настроить git), а затем повторно запустите статический анализ. Убедитесь, что рассматриваемое срабатывание больше не появляется.

### Подготовка патча
После того, как нам удалось локально исправить проблему, необходимо подготовить патч, который можно выслать разработчикам для обсуждения. Подготовить патч из последнего коммита можно командой
```
git format-patch -1 HEAD
```

Также для работы в GitHub Classroom необходимо запушить новую версию ветки libXfont-1.4.6-branch в свой репозиторий и создать pull request, к нему прикрепить все артефакты.

### Итог 1 части
В ходе 1 части мы познакомились со статическим анализатором cppcheck, который работает с исходными текстами программ, проанализировали уязвимую к CVE-2013-6462 версию библиотеки libXfont, обнаружили данную уязвимость посредством статического анализа, исправили ее и убедились в отсутствии повторного срабатывания статического анализатора.

Дополнительно:
- Сравните ваше исправление с коммитом, который действительно использовался для исправления этой уязвимости (информацию об уязвимости удобно смотреть по ее идентификатору на https://CVE.org)
- Попробуйте изменить формат вывода ошибок cppcheck, например, с помощью ключа `--template='{id} {file}:{line} {message}'`, оцените какой формат вывода ошибок представляется вам наиболее удобным для восприятия и анализа
